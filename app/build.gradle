/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java application project to get you started.
 * For more details on building Java & JVM projects, please refer to https://docs.gradle.org/8.5/userguide/building_java_projects.html in the Gradle documentation.
 */

plugins {
    // Apply the application plugin to add support for building a CLI application in Java.
    id 'application'
    id 'java'
    id 'antlr'
}

repositories {
    // Use Maven Central for resolving dependencies.
    mavenCentral()
}

dependencies {
    // Use JUnit test framework.
    testImplementation libs.junit

    // This dependency is used by the application.
    implementation libs.guava
    antlr "org.antlr:antlr4:4.9.2"
}

// Apply a specific Java toolchain to ease working on different environments.
java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(21)
    }
}

application {
    // Define the main class for the application.
    mainClass = 'rabalais.regex2english.App'
}



// task compileGeneratedClasses (type: compileJava) {
//     source = app.src.main.java.regex2english.generatedClasses


// }
tasks{

    generateGrammarSource {
    // maxHeapSize = "64m"
    arguments += ["-visitor", "-no-listener", "-package", "rabalais.regex2english"]
    outputDirectory = file("${projectDir}/src/main/java/rabalais/regex2english/generated")
        
     
    doLast {
        println "Deleting duplicate directory created on save in VSCode."
        delete 'src/main/antlr/.antlr'
        // println "Moving generated grammar files to directory outside the build folder."
        // copy {
        //     from "build/generated-src/antlr/main"
        //     into "src/main/java/regex2english/generatedClasses"
        // }
        // delete 'build/generated-src/antlr/main'

        // println "Moving generated grammar files to directory outside the build folder."
        // copy {
        //     from "build/generated-src/antlr/main"
        //     into "src/main/java/regex2english/GeneratedClasses"
        // }
        // println "Putting lexer and parser in main package."

        // def lineToAdd = 'package generatedClasses;'
        // ant.replace(file: 'src/main/java/regex2english/generatedClasses/regex2englishLexer.java', token: '// Generated from regex2english.g4 by ANTLR 4.9.2', value: lineToAdd + '\n', encoding: 'UTF-8')
        // ant.replace(file: 'src/main/java/regex2english/generatedClasses/regex2englishParser.java', token: '// Generated from regex2english.g4 by ANTLR 4.9.2', value: lineToAdd + '\n', encoding: 'UTF-8')
        // delete 'app/src/main/antlr/regex2englishLexer.java'
    }
} 

compileJava{
    dependsOn(generateGrammarSource)
}

clean{
    delete "${projectDir}/src/main/java/rabalais/regex2english/generated"
}

// referenced https://github.com/gregwhitaker/gradle-antlr-example when figuring out gradle source sets
sourceSets {
    generated{
        java.srcDir "${projectDir}/src/main/java/rabalais/regex2english/generated"
    }

    main {
        java.srcDirs += "${projectDir}/src/main/java/rabalais/regex2english/generated"
        java.srcDirs += "${projectDir}src/main/antlr/regex2english.g4"

      
    }
}

}





 